<!DOCTYPE html>
<html lang="en">
 <head>
   <meta charset="utf-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="">
   <meta name="author" content="">

   <title> InvestWiser </title>

   <!-- Bootstrap core CSS -->
   <!-- <link href="static/css/bootstrap.css" rel="stylesheet"> -->
   <link href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles for this template -->
   <link href="{{ url_for('static', filename='assets/css/main.css') }}" rel="stylesheet">
   <link href="{{ url_for('static', filename='css/jquery.autocomplete.css') }}" rel="stylesheet">
   <link href="{{ url_for('static', filename='css/pin.css') }}" rel="stylesheet">

   <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
   <!--[if lt IE 9]>
     <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
     <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
   <![endif]-->


 </head>

 <!-- <body {% if query %} onload="queryURL('{{ query }}')" {% endif %}> -->

  <div class="container">
   <div align="center">
    <a href="/"><h1 class="splash">InvestWiser</h1></a>
     <h3 class="caption">Predict Series A Crunch Outcome</h3>
        <div class="form-group">
	       <span class="input-group-btn">
	         <form class="form-inline" action="fetchcompany" method="get">
	         <input style="width: 500px; height:64px; font-size:20px;" 
		    type="text" id="company" name="company" class="form-control" placeholder="Type in startup name">  
	         <button style="font-size:20px; height:64px;" 
		     class="btn primary-button" type="submit">Predict!</button>
          </form>
	       </span>
       </div>
     </div>
     <div id="notfound-box" style="display: none" align="center"><h4>Company not found</h4></div>
     <br><br>

<!-- Button trigger modal -->
<!-- <button class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
  Launch demo modal
</button>
 -->
<!-- Modal -->
<!-- <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title" id="myModalLabel">Modal title</h4>
      </div>
      <div class="modal-body">
        ...
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>
 -->
    <!-- Prediction box -->
    <div class="container">
      <div class="centered col-md-12">   
        <div class='pin-wide' id="result-box" style="display: none">
          <div class="col-md-6"><h3>Likelihood of raising Series A</h3>
          <h2 id="prob-box"></h2></div>
          <div class="col-md-6"><h3>Series A Amount (predicted)</h3>
          <h2 id="worth-box"></h2></div>
          <br><br>
          <img class="col-xs-3 pull-left" id="company_img" src="https://s3.amazonaws.com/photos.angel.co/startups/i/32509-cfb45c2a611a38850d8ea263d89ab595-medium_jpg.jpg?buster=1326842750">
        <br><br>
       <p style="font-size:32px; font-weight:bold;" height="400px" id="company_name" align="left"></p>
       <p style="font-weight:bold" align="left" id="snippet"></p>
       <p id="prod_desc" align="left"></p>
       <a href="#" id="result-dismiss">Close<p>

          <div class="row">
         <br><br>
<!--            <div class="col-sm-4 founder" id="wrapper1">
             <img class="col-xs-8" id="founder1" src="https://s3.amazonaws.com/photos.angel.co/users/26786-medium_jpg?1306973402">
             <div class="caption" id="name1" style="font-size:32px;font-weight:bold">Jeff Lawson</div>
           </div>
           <div class="col-sm-4 founder" id="wrapper2">
             <img class="col-xs-8" id="founder2" src="https://s3.amazonaws.com/photos.angel.co/users/169245-medium_jpg?1346719228"><span><p id="name2"style="font-size:32px;font-weight:bold">John Wolthuis</p></span>
           </div>
           <div class="col-sm-4 founder" id="wrapper3">
             <img class="col-xs-8" id="founder3" src=""><span><p  id="name3" style="font-size:32px;font-weight:bold"></p></span>
            </div> -->
            
          </div>
        </div>
      </div>
    </div>
       
     <div id="columns" align="center"></div>
   </div>

    <!-- Bootstrap core JavaScript
   ================================================== -->
   <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.10.1.min.js"></script>
    <script type="text/javascript" src="https://netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="static/js/d3.v3.min.js"></script> 
    <script type="text/javascript" src="static/js/visualize.js"></script>
    <script type="text/javascript" src="{{ url_for('static', filename='js/jquery.autocomplete.js') }}"></script>
    <!-- // <script type="text/javascript" src="static/js/jquery.autocomplete.js'"></script> -->
    <script>
      // $('#company').autocomplete("{{ url_for('static', filename='names.txt') }}");
      $('#company').autocomplete("static/names.txt");
    </script>  

  <!-- Script for fetching company data -->
   <!-- ================================================== --> 
    <script type="text/javascript">
    // Fetch prediction
    var g_data=[]; 
    d3.csv('static/predictions/RF_classify_and_regress.csv', function (data) { g_data = data; } );
    // Load companies data
    var c_data = []; 
    d3.csv('static/companies.csv', function (data) { c_data = data; } );
    // Load companies description
    d3.csv('static/predictions/company_snippets.csv', function (data) {sn_data = data;} );

    function fetchResults(s) {
           for (j in c_data) {
        r = c_data[j]; 
        if (r.company_name.toLowerCase() == s.toLowerCase()) { cj = j; }
        }

      for (k in sn_data) {
        sn = sn_data[k];
        if (sn.company_name.toLowerCase() == s.toLowerCase()) { sk = k; }
      }
    
      target = g_data[gi].company_name;
      prob = g_data[gi].RFCprobA;
      aval = g_data[gi].RFRval;
      worth = g_data[gi].RFRpred; 
      worthval = (worth/1000000).toPrecision(3);
      aval = (aval/1000000).toPrecision(3);
      // snippet = sn_data[sk].high_concept

      if (aval != 0) {
        $('#worth-box').html('<h2> $' + worthval + 'M</h2><h3>($' + aval + 'M)</h3>');
      } else {
        if (prob < 0.3) {
          $('#worth-box').html('<h2> <$1M </h2>');
        } else {
          $('#worth-box').html('<h2> $' + worthval + 'M </h2>');
        }
      }

      $('#prob-box').html('<h2>' + (prob*100).toPrecision(3) + ' % </h2>');      
      $('#company_img').attr('src', c_data[cj].company_img);
      $('#company_name').text(c_data[cj].company_name);
      $('#snippet').text(sn_data[sk].high_concept);

      // Add Read more clickable if there's more snippets
      if (sn_data[sk].product_desc !== "") { 
        $('#prod_desc').html("<a href='#' id='more_prod_desc'>More Info</a>");
        $('#more_prod_desc').click(function (e) { 
          e.preventDefault(); 
          $(this).html(sn_data[sk].product_desc);
        });
      }
      // $('#prod_desc').text(sn_data[sk].product_desc);
      // founder_counter = 1;
      // for(i in c_data) {
      //   if(c_data[i].company_name.toLowerCase() == s.toLowerCase()) {
      //     $('#founder' + founder_counter).attr('src', '');
      //     $('#founder' + founder_counter).attr('src', c_data[i].founder_img);
      //     $('#name' + founder_counter).text(c_data[i].founder_name);          
      //     $('#name' + founder_counter).css(c_data[i].founder_name);
      //     $('#wrapper' + founder_counter).show(); 
      //     founder_counter = founder_counter + 1;           
      //   }
      // }
    }

    // Form submission
    $('form').submit(function (e) { 
      e.preventDefault(); 
      s = $('input').val();
      console.log(s); 
      gi = "None"
      for(i in g_data) {
        row = g_data[i]; 
        if (row.name.toLowerCase() == s.toLowerCase()) { gi = i; }
        }

      if (gi === "None") { $('#notfound-box').toggle(); } 
      else { 
        fetchResults(s);
        $('#result-box').fadeIn();    
       }
    });

    // Read more

    // Close Result box 
    $('#result-dismiss').click(function (e) {
      e.preventDefault();
      $('#result-box').fadeOut();
    })
  </script>

<!-- // Load grid icons with links -->
  <script type="text/javascript">
    d3.csv('static/companies_pred.csv', function (data) {
      for (i in data) {
      $('#columns').append(
        "<div class='pin' data-company=" + data[i].company_name + ">" + 
        // "<a href='/fetchcompany?company=" + data[i].company_name + "'>" + 
        "<img data-company=" + data[i].company_name + " src=" + data[i].company_img + " height='40px'></img>" + 
        "</a></div>"
        );  
      }
    });
  </script>

  <script type="text/javascript">
  function readyPin(jQuery) {
    // Load prediction data
   var g_data=[]; 
    d3.csv('static/predictions/RF_classify_and_regress.csv', function (data) { g_data = data; } );
    // Load companies data
    var c_data = []; 
    d3.csv('static/companies.csv', function (data) { c_data = data; } );
    // Pin click responses
    $('#columns').on("click", ".pin", function (e) {
      e.preventDefault();
      s = $(this).attr('data-company');
      for(i in g_data) {
          row = g_data[i]; 
          if (row.name.toLowerCase() == s.toLowerCase()) { gi = i; } }

        for (j in c_data) {
          r = c_data[j]; 
          if (r.company_name.toLowerCase() == s.toLowerCase()) { cj = j; } }

        for (k in sn_data) {
          sn = sn_data[k];
          if (sn.company_name.toLowerCase() == s.toLowerCase()) { sk = k; }
        }

          target = g_data[gi].company_name;
          prob = g_data[gi].RFCprobA;
          aval = g_data[gi].RFRval;
          worth = g_data[gi].RFRpred; 
          worthval = (worth/1000000).toPrecision(3);
          aval = (aval/1000000).toPrecision(3);

          if (aval != 0) {
            $('#worth-box').html('<h2> $' + worthval + 'M</h2><h3>($' + aval + 'M)</h3>');
          } else {
            if (prob < 0.3) {
              $('#worth-box').html('<h2> <$1M </h2>');
            } else {
              $('#worth-box').html('<h2> $' + worthval + 'M </h2>');
            }
          }
          $('#prob-box').html('<h2>' + (prob*100).toPrecision(3) + ' % </h2>');
          $('#company_img').attr('src', c_data[cj].company_img);
          $('#company_name').text(c_data[cj].company_name);

          $('#snippet').text(sn_data[sk].high_concept);

          // Add Read more clickable if there's more snippets
          if (sn_data[sk].product_desc !== "") { 
          $('#prod_desc').html("<a href='#' id='more_prod_desc'>More Info</a>");
          $('#more_prod_desc').click(function (e) { 
            e.preventDefault(); 
            $(this).html(sn_data[sk].product_desc);
        });
      }

      //     $('#prod_desc').text(sn_data[sk].product_desc);
      // founder_counter = 1;
      // for(i in c_data) {
      //   if(c_data[i].company_name.toLowerCase() == s.toLowerCase()) {
      //     $('#founder' + founder_counter).attr('src', '');
      //     $('#founder' + founder_counter).attr('src', c_data[i].founder_img);
      //     $('#name' + founder_counter).text(c_data[i].founder_name);          
      //     $('#name' + founder_counter).css(c_data[i].founder_name);
      //     $('#wrapper' + founder_counter).show(); 
      //     founder_counter = founder_counter + 1;           
      //   }
      // }
      $('#result-box').fadeIn();
    });
    }

  $(document).ready(readyPin);
  </script>      
 </body>
</html>